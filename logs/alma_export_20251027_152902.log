2025-10-27 15:29:02 - root - INFO - setup_logging:64 - ==================================================
2025-10-27 15:29:02 - root - INFO - setup_logging:65 - Alma Digital Title Export Application Started
2025-10-27 15:29:02 - root - INFO - setup_logging:66 - Log file: logs/alma_export_20251027_152902.log
2025-10-27 15:29:02 - root - INFO - setup_logging:67 - ==================================================
2025-10-27 15:29:02 - __main__ - INFO - <module>:600 - Application startup
2025-10-27 15:29:02 - __main__ - INFO - <module>:601 - Log file location: logs/alma_export_20251027_152902.log
2025-10-27 15:29:02 - asyncio - DEBUG - __init__:64 - Using selector: KqueueSelector
2025-10-27 15:29:02 - flet - INFO - __get_assets_dir_path:371 - Assets path configured: /Users/mcfatem/GitHub/alma-export-to-CSV/assets
2025-10-27 15:29:02 - flet - DEBUG - __init__:20 - Creating new PubSubHub instance
2025-10-27 15:29:02 - flet - DEBUG - __init__:20 - Creating new PubSubHub instance
2025-10-27 15:29:02 - flet - INFO - start:72 - Starting up UDS server on /var/folders/jc/p0y112bn30v3kkx1vfcvhczm5kr3r4/T/6Tq1cJYtX0
2025-10-27 15:29:02 - flet - INFO - app_async:171 - Flet app has started...
2025-10-27 15:29:02 - flet - INFO - on_app_startup:131 - App URL: /var/folders/jc/p0y112bn30v3kkx1vfcvhczm5kr3r4/T/6Tq1cJYtX0
2025-10-27 15:29:02 - flet_desktop - INFO - __locate_and_unpack_flet_view:62 - Starting Flet View app...
2025-10-27 15:29:02 - flet_desktop - INFO - __locate_and_unpack_flet_view:142 - Flet View found in: /Users/mcfatem/.flet/bin/flet-0.28.3
2025-10-27 15:29:02 - flet - DEBUG - handle_connection:88 - Connected new TCP client
2025-10-27 15:29:02 - flet - DEBUG - __on_message:121 - _on_message: {"action":"registerWebClient","payload":{"pageName":"var/folders","pageRoute":"/","pageWidth":"800.0","pageHeight":"600.0","windowWidth":"800.0","windowHeight":"628.0","windowTop":"134.0","windowLeft":"3992.0","isPWA":"false","isWeb":"false","isDebug":"false","platform":"macos","platformBrightness":"light","media":"{\"padding\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0},\"view_padding\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0},\"view_insets\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0}}","sessionId":""}}
2025-10-27 15:29:02 - flet - DEBUG - __send:177 - __send: {"action":"registerWebClient","payload":{"session":{"id":"","controls":{"page":{"i":"page","t":"page","p":"","c":[],"route":"/","width":"800.0","height":"600.0","windowwidth":"800.0","windowheight":"628.0","windowtop":"134.0","windowleft":"3992.0","pwa":"false","web":"false","debug":"false","platform":"macos","platformBrightness":"light","media":"{\"padding\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0},\"view_padding\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0},\"view_insets\":{\"top\":0.0,\"right\":0.0,\"bottom\":0.0,\"left\":0.0}}"}}},"error":"","appInactive":false}}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'route'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'pwa'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'web'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'debug'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'platform'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'platformBrightness'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'media'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'width'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'height'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'windowWidth'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'windowHeight'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'windowTop'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'windowLeft'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'clientIP'] {}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: get ['page', 'clientUserAgent'] {}
2025-10-27 15:29:02 - flet - INFO - on_session_created:240 - App session started
2025-10-27 15:29:02 - __main__ - INFO - main:588 - Starting Flet application
2025-10-27 15:29:02 - __main__ - DEBUG - main:589 - Page details - title: None, theme: ThemeMode.SYSTEM
2025-10-27 15:29:02 - flet - DEBUG - __send_loop:114 - sent to TCP: 604
2025-10-27 15:29:02 - __main__.AlmaExportApp - INFO - __init__:398 - Initializing AlmaExportApp
2025-10-27 15:29:02 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"app_lifecycle_state_change","eventData":"show"}}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: set ['page'] {'title': 'Alma Digital Title Export to CSV'}
2025-10-27 15:29:02 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"app_lifecycle_state_change","eventData":"resume"}}
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: add [] {'to': 'page', 'at': '0'}
2025-10-27 15:29:02 - flet - DEBUG - on_event_async:856 - page.on_event_async: page app_lifecycle_state_change show
2025-10-27 15:29:02 - flet - DEBUG - _process_command:85 - _process_command: add [] {'to': 'page', 'at': '1'}
2025-10-27 15:29:02 - flet - DEBUG - on_event_async:856 - page.on_event_async: page app_lifecycle_state_change resume
2025-10-27 15:29:02 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"page","title":"Alma Digital Title Export to CSV"}]}},{"action":"addPageControls","payload":{"controls":[{"t":"view","i":"_1","p":"page","c":["_2"],"at":"0","padding":"20","scroll":"adaptive"},{"t":"container","i":"_2","p":"_1","c":["_3"],"padding":"20"},{"t":"column","i":"_3","p":"_2","c":["_4","_5","_6","_7","_8","_9","_10","_11","_12","_13","_14","_15"],"horizontalalignment":"start","n":"content","spacing":"10"},{"t":"text","i":"_4","p":"_3","c":[],"color":"blue900","size":"24","value":"Alma Digital Title Export to CSV","weight":"bold"},{"t":"divider","i":"_5","p":"_3","c":[],"color":"blue200","height":"20"},{"t":"text","i":"_6","p":"_3","c":[],"color":"grey700","size":"14","value":"Search for digital titles in Alma and export metadata to CSV"},{"t":"container","i":"_7","p":"_3","c":[],"height":"20"},{"t":"textfield","i":"_8","p":"_3","c":[],"canrevealpassword":"true","hinttext":"Enter your Alma API key","label":"Alma API Key","password":"true","value":"l8xx948a6fc96754492f89820aa25a064b06","width":"400"},{"t":"textfield","i":"_9","p":"_3","c":[],"hinttext":"Enter title to search","label":"Title Search","width":"400"},{"t":"container","i":"_10","p":"_3","c":[],"height":"10"},{"t":"elevatedbutton","i":"_11","p":"_3","c":[],"icon":"search","style":"{\"padding\":{},\"side\":{},\"shape\":{},\"text_style\":{}}","text":"Search and Export"},{"t":"progressbar","i":"_12","p":"_3","c":[],"visible":"false","width":"400"},{"t":"container","i":"_13","p":"_3","c":[],"height":"20"},{"t":"text","i":"_14","p":"_3","c":[],"color":"blue700","size":"14"},{"t":"text","i":"_15","p":"_3","c":[],"selectable":"true","size":"14"}],"trimIDs":[]}},{"action":"addPageControls","payload":{"controls":[{"t":"offstage","i":"_16","p":"page","c":[],"at":"1"}],"trimIDs":[]}}]}
2025-10-27 15:29:02 - __main__ - INFO - main:593 - Application initialized successfully
2025-10-27 15:29:02 - flet - DEBUG - __send_loop:114 - sent to TCP: 1874
2025-10-27 15:29:04 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"focus","eventData":null}}
2025-10-27 15:29:04 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 focus None
2025-10-27 15:29:05 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"click","eventData":null}}
2025-10-27 15:29:05 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 click None
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"G"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"G"}]
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Gr"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Gr"}]
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Gri"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Gri"}]
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grin"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grin"}]
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinn"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinn"}]
2025-10-27 15:29:06 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinne"}]}}
2025-10-27 15:29:06 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinne"}]
2025-10-27 15:29:07 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinnel"}]}}
2025-10-27 15:29:07 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinnel"}]
2025-10-27 15:29:07 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinnell"}]}}
2025-10-27 15:29:07 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinnell"}]
2025-10-27 15:29:08 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinnell*"}]}}
2025-10-27 15:29:08 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinnell*"}]
2025-10-27 15:29:09 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"submit","eventData":"Grinnell*"}}
2025-10-27 15:29:09 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 submit Grinnell*
2025-10-27 15:29:09 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"blur","eventData":null}}
2025-10-27 15:29:09 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 blur None
2025-10-27 15:29:11 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"click","eventData":null}}
2025-10-27 15:29:11 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 click None
2025-10-27 15:29:11 - __main__.AlmaExportApp - INFO - search_and_export:486 - Search and export operation started
2025-10-27 15:29:11 - __main__.AlmaExportApp - DEBUG - search_and_export:492 - Input validation - API key length: 36, Search query: 'Grinnell*'
2025-10-27 15:29:11 - __main__.AlmaExportApp - INFO - search_and_export:505 - Initializing Alma API client
2025-10-27 15:29:11 - __main__.AlmaAPIClient - INFO - __init__:94 - AlmaAPIClient initialized with base_url: https://api-na.hosted.exlibrisgroup.com
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - __init__:95 - API key length: 36 characters
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_11'] {'disabled': 'true'}
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_12'] {'visible': 'true'}
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_14'] {'value': 'Searching for digital titles...'}
2025-10-27 15:29:11 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_11","disabled":"true"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_12","visible":"true"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_14","value":"Searching for digital titles..."}]}}]}
2025-10-27 15:29:11 - __main__.AlmaExportApp - INFO - search_and_export:517 - Starting search operation at 2025-10-27 15:29:11.264676
2025-10-27 15:29:11 - __main__.AlmaExportApp - INFO - search_and_export:521 - Executing search for query: 'Grinnell*'
2025-10-27 15:29:11 - flet - DEBUG - __send_loop:114 - sent to TCP: 321
2025-10-27 15:29:11 - __main__.AlmaAPIClient - INFO - search_bibs:108 - Starting bibliographic search for query: 'Grinnell*'
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:109 - Search parameters - limit: 100
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:119 - Constructed API search query: title~Grinnell*
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:131 - Page 1: Requesting 100 records starting at offset 0
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:132 - API endpoint: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs
2025-10-27 15:29:11 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"blur","eventData":null}}
2025-10-27 15:29:11 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 blur None
2025-10-27 15:29:11 - urllib3.connectionpool - DEBUG - _new_conn:1049 - Starting new HTTPS connection (1): api-na.hosted.exlibrisgroup.com:443
2025-10-27 15:29:11 - urllib3.connectionpool - DEBUG - _make_request:544 - https://api-na.hosted.exlibrisgroup.com:443 "GET /almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail HTTP/1.1" 400 None
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:136 - API response status: 400
2025-10-27 15:29:11 - __main__.AlmaAPIClient - ERROR - search_bibs:161 - API request failed on page 1: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:29:11 - __main__.AlmaAPIClient - DEBUG - search_bibs:162 - Failed request details - endpoint: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs, params: {'q': 'title~Grinnell*', 'limit': 100, 'offset': 0, 'expand': 'p_avail,e_avail,d_avail'}
2025-10-27 15:29:11 - __main__.AlmaExportApp - ERROR - search_and_export:553 - Search and export failed: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
Traceback (most recent call last):
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 138, in search_bibs
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/.venv/lib/python3.13/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 522, in search_and_export
    bibs = self.api_client.search_bibs(search_query)
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 163, in search_bibs
    raise Exception(f"API request failed: {str(e)}")
Exception: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:29:11 - __main__.AlmaExportApp - ERROR - show_error:564 - Displaying error to user: Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_14'] {'color': 'red700', 'value': '❌ Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail'}
2025-10-27 15:29:11 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_14","color":"red700","value":"\u274c Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell%2A&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail"}]}}]}
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_11'] {'disabled': 'false'}
2025-10-27 15:29:11 - flet - DEBUG - _process_command:85 - _process_command: set ['_12'] {'visible': 'false'}
2025-10-27 15:29:11 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_11","disabled":"false"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_12","visible":"false"}]}}]}
2025-10-27 15:29:11 - flet - DEBUG - __send_loop:114 - sent to TCP: 330
2025-10-27 15:29:11 - __main__.AlmaExportApp - DEBUG - search_and_export:560 - UI reset completed
2025-10-27 15:29:11 - flet - DEBUG - __send_loop:114 - sent to TCP: 215
2025-10-27 15:29:11 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"blur","eventData":null}}
2025-10-27 15:29:11 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 blur None
2025-10-27 15:29:31 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"135.0","windowleft":"3956.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:31 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:31 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"135.0","windowleft":"3956.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:31 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"150.0","windowleft":"3199.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"150.0","windowleft":"3199.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"161.0","windowleft":"2784.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"161.0","windowleft":"2784.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"164.0","windowleft":"2766.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"164.0","windowleft":"2766.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"137.0","windowleft":"2741.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"137.0","windowleft":"2741.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"122.0","windowleft":"2684.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"122.0","windowleft":"2684.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"121.0","windowleft":"2646.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"121.0","windowleft":"2646.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"119.0","windowleft":"2626.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"119.0","windowleft":"2626.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"116.0","windowleft":"2572.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:32 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"116.0","windowleft":"2572.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:32 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"115.0","windowleft":"2540.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"115.0","windowleft":"2540.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"95.0","windowleft":"2491.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"95.0","windowleft":"2491.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"82.0","windowleft":"2467.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"82.0","windowleft":"2467.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"81.0","windowleft":"2466.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]}}
2025-10-27 15:29:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"moved"}}
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"81.0","windowleft":"2466.0","windowminimized":"false","windowmaximized":"false","windowfocused":"true","windowfullscreen":"false"}]
2025-10-27 15:29:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event moved
2025-10-27 15:30:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"focus","eventData":null}}
2025-10-27 15:30:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 focus None
2025-10-27 15:30:33 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"click","eventData":null}}
2025-10-27 15:30:33 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 click None
2025-10-27 15:30:34 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"_9","value":"Grinnell"}]}}
2025-10-27 15:30:34 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"_9","value":"Grinnell"}]
2025-10-27 15:30:35 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"submit","eventData":"Grinnell"}}
2025-10-27 15:30:35 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 submit Grinnell
2025-10-27 15:30:35 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_9","eventName":"blur","eventData":null}}
2025-10-27 15:30:35 - flet - DEBUG - on_event_async:856 - page.on_event_async: _9 blur None
2025-10-27 15:30:37 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"click","eventData":null}}
2025-10-27 15:30:37 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 click None
2025-10-27 15:30:37 - __main__.AlmaExportApp - INFO - search_and_export:486 - Search and export operation started
2025-10-27 15:30:37 - __main__.AlmaExportApp - DEBUG - search_and_export:492 - Input validation - API key length: 36, Search query: 'Grinnell'
2025-10-27 15:30:37 - __main__.AlmaExportApp - INFO - search_and_export:505 - Initializing Alma API client
2025-10-27 15:30:37 - __main__.AlmaAPIClient - INFO - __init__:94 - AlmaAPIClient initialized with base_url: https://api-na.hosted.exlibrisgroup.com
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - __init__:95 - API key length: 36 characters
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_11'] {'disabled': 'true'}
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_12'] {'visible': 'true'}
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_14'] {'color': 'blue700', 'value': 'Searching for digital titles...'}
2025-10-27 15:30:37 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_11","disabled":"true"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_12","visible":"true"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_14","color":"blue700","value":"Searching for digital titles..."}]}}]}
2025-10-27 15:30:37 - __main__.AlmaExportApp - INFO - search_and_export:517 - Starting search operation at 2025-10-27 15:30:37.214436
2025-10-27 15:30:37 - __main__.AlmaExportApp - INFO - search_and_export:521 - Executing search for query: 'Grinnell'
2025-10-27 15:30:37 - flet - DEBUG - __send_loop:114 - sent to TCP: 339
2025-10-27 15:30:37 - __main__.AlmaAPIClient - INFO - search_bibs:108 - Starting bibliographic search for query: 'Grinnell'
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:109 - Search parameters - limit: 100
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:119 - Constructed API search query: title~Grinnell
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:131 - Page 1: Requesting 100 records starting at offset 0
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:132 - API endpoint: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs
2025-10-27 15:30:37 - urllib3.connectionpool - DEBUG - _new_conn:1049 - Starting new HTTPS connection (1): api-na.hosted.exlibrisgroup.com:443
2025-10-27 15:30:37 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"blur","eventData":null}}
2025-10-27 15:30:37 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 blur None
2025-10-27 15:30:37 - urllib3.connectionpool - DEBUG - _make_request:544 - https://api-na.hosted.exlibrisgroup.com:443 "GET /almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail HTTP/1.1" 400 None
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:136 - API response status: 400
2025-10-27 15:30:37 - __main__.AlmaAPIClient - ERROR - search_bibs:161 - API request failed on page 1: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:30:37 - __main__.AlmaAPIClient - DEBUG - search_bibs:162 - Failed request details - endpoint: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs, params: {'q': 'title~Grinnell', 'limit': 100, 'offset': 0, 'expand': 'p_avail,e_avail,d_avail'}
2025-10-27 15:30:37 - __main__.AlmaExportApp - ERROR - search_and_export:553 - Search and export failed: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
Traceback (most recent call last):
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 138, in search_bibs
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/.venv/lib/python3.13/site-packages/requests/models.py", line 1026, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 522, in search_and_export
    bibs = self.api_client.search_bibs(search_query)
  File "/Users/mcfatem/GitHub/alma-export-to-CSV/app.py", line 163, in search_bibs
    raise Exception(f"API request failed: {str(e)}")
Exception: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:30:37 - __main__.AlmaExportApp - ERROR - show_error:564 - Displaying error to user: Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_14'] {'color': 'red700', 'value': '❌ Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail'}
2025-10-27 15:30:37 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_14","color":"red700","value":"\u274c Error: API request failed: 400 Client Error:  for url: https://api-na.hosted.exlibrisgroup.com/almaws/v1/bibs?q=title~Grinnell&limit=100&offset=0&expand=p_avail%2Ce_avail%2Cd_avail"}]}}]}
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_11'] {'disabled': 'false'}
2025-10-27 15:30:37 - flet - DEBUG - _process_command:85 - _process_command: set ['_12'] {'visible': 'false'}
2025-10-27 15:30:37 - flet - DEBUG - __send:177 - __send: {"action":"pageControlsBatch","payload":[{"action":"updateControlProps","payload":{"props":[{"i":"_11","disabled":"false"}]}},{"action":"updateControlProps","payload":{"props":[{"i":"_12","visible":"false"}]}}]}
2025-10-27 15:30:37 - flet - DEBUG - __send_loop:114 - sent to TCP: 327
2025-10-27 15:30:37 - __main__.AlmaExportApp - DEBUG - search_and_export:560 - UI reset completed
2025-10-27 15:30:37 - flet - DEBUG - __send_loop:114 - sent to TCP: 215
2025-10-27 15:30:37 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"_11","eventName":"blur","eventData":null}}
2025-10-27 15:30:37 - flet - DEBUG - on_event_async:856 - page.on_event_async: _11 blur None
2025-10-27 15:31:10 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"app_lifecycle_state_change","eventData":"inactive"}}
2025-10-27 15:31:10 - flet - DEBUG - on_event_async:856 - page.on_event_async: page app_lifecycle_state_change inactive
2025-10-27 15:31:10 - flet - DEBUG - __on_message:121 - _on_message: {"action":"updateControlProps","payload":{"props":[{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"81.0","windowleft":"2466.0","windowminimized":"false","windowmaximized":"false","windowfocused":"false","windowfullscreen":"false"}]}}
2025-10-27 15:31:10 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"window_event","eventData":"blur"}}
2025-10-27 15:31:10 - flet - DEBUG - on_event_async:856 - page.on_event_async: page change [{"i":"page","windowwidth":"800.0","windowheight":"628.0","windowtop":"81.0","windowleft":"2466.0","windowminimized":"false","windowmaximized":"false","windowfocused":"false","windowfullscreen":"false"}]
2025-10-27 15:31:10 - flet - DEBUG - on_event_async:856 - page.on_event_async: page window_event blur
2025-10-27 15:34:34 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"app_lifecycle_state_change","eventData":"hide"}}
2025-10-27 15:34:34 - flet - DEBUG - on_event_async:856 - page.on_event_async: page app_lifecycle_state_change hide
2025-10-27 15:34:34 - flet - DEBUG - __on_message:121 - _on_message: {"action":"pageEventFromWeb","payload":{"eventTarget":"page","eventName":"app_lifecycle_state_change","eventData":"show"}}
2025-10-27 15:34:34 - flet - DEBUG - on_event_async:856 - page.on_event_async: page app_lifecycle_state_change show
2025-10-27 15:35:30 - flet - DEBUG - exit_gracefully:141 - Gracefully terminating Flet app...
2025-10-27 15:35:30 - flet_desktop - DEBUG - close_flet_view:53 - Flet View process 70353
2025-10-27 15:35:30 - flet - DEBUG - close:181 - Closing connection...
2025-10-27 15:35:30 - flet - DEBUG - close:183 - Disconnecting all pages...
2025-10-27 15:35:30 - flet - DEBUG - on_event_async:856 - page.on_event_async: page disconnect 
2025-10-27 15:35:30 - flet - DEBUG - close:189 - Shutting down thread pool...
2025-10-27 15:35:30 - __main__ - INFO - <module>:609 - Application shutdown
2025-10-27 15:35:30 - root - INFO - <module>:610 - ==================================================
